<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerenciador de Bloqueio Squid</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: #f4f7f6;
            color: #333;
            margin: 0;
            padding: 20px;
            display: grid;
            place-items: center;
            min-height: 90vh;
        }
        .container {
            width: 100%;
            max-width: 600px;
            background: #fff;
            padding: 25px 30px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        h1, h2 {
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
            margin-top: 0;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }
        input[type="text"] {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-sizing: border-box; /* Importante para o padding n√£o quebrar o layout */
        }
        .buttons {
            display: flex;
            gap: 10px;
        }
        button {
            flex-grow: 1;
            padding: 12px 15px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        #btn-add {
            background-color: #d9534f; /* Vermelho bloqueio */
            color: white;
        }
        #btn-add:hover { background-color: #c9302c; }
        
        #btn-remove {
            background-color: #5cb85c; /* Verde desbloqueio */
            color: white;
        }
        #btn-remove:hover { background-color: #4cae4c; }

        #status-message {
            text-align: center;
            font-weight: bold;
            padding: 10px;
            border-radius: 5px;
            display: none; /* Come√ßa escondido */
        }
        #status-message.success { background-color: #e6ffed; color: #2d6b2d; }
        #status-message.error { background-color: #ffeaef; color: #d9534f; }

        ul#blocklist {
            list-style: none;
            padding: 0;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #eee;
            border-radius: 5px;
        }
        ul#blocklist li {
            padding: 10px 15px;
            border-bottom: 1px solid #eee;
        }
        ul#blocklist li:last-child { border-bottom: none; }
    </style>
</head>
<body>

    <div class="container">
        <h1>üîí Gerenciador do Squid</h1>
        
        <div class="form-group">
            <label for="domain-input">Dom√≠nio:</label>
            <input type="text" id="domain-input" placeholder="ex: siteteste.com">
        </div>

        <div class="buttons">
            <button id="btn-add">Bloquear</button>
            <button id="btn-remove">Desbloquear</button>
        </div>

        <p id="status-message"></p>

        <h2>Lista de Bloqueio Atual</h2>
        <ul id="blocklist">
            <li>Carregando...</li>
        </ul>
    </div>

    <script>
        // URL da sua API. Como estamos servindo o HTML do mesmo lugar,
        // podemos usar caminhos relativos (come√ßando com '/')
        const API_BASE_URL = window.location.origin; // ex: http://172.16.58.108:5000

        // Elementos da p√°gina
        const domainInput = document.getElementById('domain-input');
        const addButton = document.getElementById('btn-add');
        const removeButton = document.getElementById('btn-remove');
        const blocklistUl = document.getElementById('blocklist');
        const statusMessage = document.getElementById('status-message');

        // Mostra uma mensagem de status (sucesso ou erro)
        function showStatus(message, isError = false) {
            statusMessage.textContent = message;
            statusMessage.className = isError ? 'error' : 'success';
            statusMessage.style.display = 'block';
            
            // Esconde a mensagem depois de 3 segundos
            setTimeout(() => {
                statusMessage.style.display = 'none';
            }, 3000);
        }

        // Atualiza a lista de dom√≠nios na tela
        async function fetchBlocklist() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/blocklist`);
                if (!response.ok) throw new Error('Falha ao carregar a lista.');
                
                const domains = await response.json();
                
                blocklistUl.innerHTML = ''; // Limpa a lista
                if (domains.length === 0) {
                    blocklistUl.innerHTML = '<li>Nenhum site bloqueado.</li>';
                } else {
                    domains.forEach(domain => {
                        const li = document.createElement('li');
                        li.textContent = domain;
                        blocklistUl.appendChild(li);
                    });
                }
            } catch (error) {
                showStatus(error.message, true);
                blocklistUl.innerHTML = '<li>Erro ao carregar a lista.</li>';
            }
        }

        // Fun√ß√£o para Adicionar ou Remover
        async function handleDomainAction(action) {
            const domain = domainInput.value.trim();
            if (!domain) {
                showStatus('Por favor, insira um dom√≠nio.', true);
                return;
            }

            const url = (action === 'add') 
                ? `${API_BASE_URL}/api/blocklist/add` 
                : `${API_BASE_URL}/api/blocklist/remove`;

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ domain: domain })
                });

                const result = await response.json();

                if (!response.ok) {
                    throw new Error(result.description || 'Ocorreu um erro.');
                }

                showStatus(result.message, false); // Mensagem de sucesso
                domainInput.value = ''; // Limpa o campo
                fetchBlocklist(); // Atualiza a lista

            } catch (error) {
                showStatus(error.message, true);
            }
        }

        // --- Event Listeners ---
        // Adiciona os eventos aos bot√µes
        addButton.addEventListener('click', () => handleDomainAction('add'));
        removeButton.addEventListener('click', () => handleDomainAction('remove'));

        // Carrega a lista inicial quando a p√°gina √© aberta
        document.addEventListener('DOMContentLoaded', fetchBlocklist);
    </script>

</body>
</html>
